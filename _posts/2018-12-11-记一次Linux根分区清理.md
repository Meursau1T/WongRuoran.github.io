---
layout: post
title:  "记一次Linux根分区清理"
date:   2018-12-11 14:54:01
categories: [Linux]
---

升级系统时zypper突然告诉我磁盘空间不足，进程终止了。我开终端用df -h看了一下，果然根分区占满了，还没多看几眼，终端就被崩溃了，我不得不去查找到底是什么在占用内存。

因为我的根分区格式时btrfs，所以我先看的是快照，用=sudo du -lh --max-depth=1 /.snapshots=看了一眼，吓了一跳，加起来足足112G。然而这不现实，我根分区一共才40G，先不管那么多，上去就把所有的快照全部清空。然后再=sudo du -lh --max-depth=1 /=，发现var占用很高，进入var后，故伎重施，找到了最高占用的cache\zypp\packages目录，里面是几个月前的安装包，统统删除。

这样下来，占用率降低到了83%。虽然我还想继续清除，但一看剩下占用最高的目录是/opt和/usr，只得收手。

总结：
根分区满了，主要看/var和/.snapshots两个文件夹，然后利用=du -lh --max-depth=1=查看当前目录下各个文件夹的大小，由此寻找需要删除的大文件。因为linux下文件被删除后正在使用被删除文件的应用还会继续工作，因此被删除的文件所在的空间并不会被释放，需要重启电脑或者kill掉占用的进程来释放空间。
